
services:
  # 1. UserService
  userservice:
    build:
      context: .
      dockerfile: src/Services/UserService/UserService.Api/Dockerfile
    container_name: bookbridge_userservice
    environment:
      ConnectionStrings__UserServiceConnection: User Id=postgres.hhmcmpnmytivfgsvbwpo;Password=0328802216Zz.;Server=aws-1-us-east-2.pooler.supabase.com;Port=5432;Database=postgres;SslMode=Require;Trust Server Certificate=true;
      Jwt__Key: BookbridgeJWTKey_2025_Secure_ABC123!
      ASPNETCORE_ENVIRONMENT: Development
    ports:
      - "5141:8080"

  # 2. BookService
  bookservice:
    build:
      context: .
      dockerfile: src/Services/BookService/BookService.Api/Dockerfile
    container_name: bookbridge_bookservice
    environment:
      ConnectionStrings__BookServiceConnection: User Id=postgres.qkvwegpygfusjevgvodl;Password=0328802216Zz.;Server=aws-1-us-east-1.pooler.supabase.com;Port=5432;Database=postgres;SslMode=Require;Trust Server Certificate=true;
      Jwt__Key: BookbridgeJWTKey_2025_Secure_ABC123!
      ASPNETCORE_ENVIRONMENT: Development
    ports:
      - "5142:8080"

  # 3. BookStoreService
  bookstoreservice:
    build:
      context: .
      dockerfile: src/Services/BookStoreService/BookStoreService.Api/Dockerfile
    container_name: bookbridge_bookstoreservice
    environment:
      ConnectionStrings__BookStoreServiceConnection: User Id=postgres.yleefbhixmhymyoydjmz;Password=0328802216Zz.;Server=aws-1-us-east-1.pooler.supabase.com;Port=5432;Database=postgres;SslMode=Require;Trust Server Certificate=true;
      Jwt__Key: BookbridgeJWTKey_2025_Secure_ABC123!
      ASPNETCORE_ENVIRONMENT: Development
    ports:
      - "5143:8080"

  # 4. OrderService
  orderservice:
    build:
      context: .
      dockerfile: src/Services/OrderService/OrderService.Api/Dockerfile
    container_name: bookbridge_orderservice
    environment:
      ConnectionStrings__OrderServiceConnection: User Id=postgres.xxrbfvbzbljnhrbpnlcj;Password=0328802216Zz.;Server=aws-1-us-east-2.pooler.supabase.com;Port=5432;Database=postgres;SslMode=Require;Trust Server Certificate=true;
      Jwt__Key: BookbridgeJWTKey_2025_Secure_ABC123!
      ASPNETCORE_ENVIRONMENT: Development
    ports:
      - "5144:8080"

  # 5. API Gateway
  gateway:
    build:
      context: .
      dockerfile: src/ApiGateway/Dockerfile
    container_name: bookbridge_gateway
    ports:
      - "5139:8080"
    depends_on:
      - userservice
      - bookservice
      - bookstoreservice
      - orderservice

  # 6. Redis cache
  redis:
    image: redis:7.2
    container_name: redis_cache
    restart: always
    ports:
      - "6379:6379"

volumes:
  pgadmin_data:
